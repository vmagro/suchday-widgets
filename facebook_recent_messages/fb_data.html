<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Get Facebook Info</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <h3>Recent conversations</h3>
            <p id="unread-count"></p>
        </div>
        <div class="row" id="recent-convos">

        </div>
    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="moment.min.js"></script>
    <script src="fb_messages.js"></script>
    <script>
        var inboxData;
        var myInfo;

        (function() {
            //Later on, inboxData should call the actual fb url call with the access_token taken from our api
            $.getJSON("https://graph.facebook.com/me/inbox?access_token=", function(json) {
                console.log("We attempted to get inbox data");
                console.log("Inbox length: " + json.data.length)
                if (json.data.length > 5) {
                    console.log("Facebook convos longer than 5");
                    json.data = json.data.slice(0, 5);
                }
                inboxData = json;
                myInfo = $.getJSON("https://graph.facebook.com/me?access_token=", function(json) {
                    console.log("We attempted to get my data");
                    myInfo = json;
                });
            }).done(function() {
                $("#unread-count").html(getReadUnreadString());
                var convoListHtml;
                for (var i = 0; i < getConversationIndexCount(); i++) {
                    convoListHtml += ("<div class='row'><strong>" + prettyParticipants(i) + "</strong><br />" + getConversationSnippet(i) + "<br /><em>" + getDateString(i) + "</em></div>")
                }
                $("#recent-convos").empty().html(convoListHtml);
            });
        })();
    </script>
</body>

</html>
