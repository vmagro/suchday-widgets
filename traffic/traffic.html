<html>
<head>
</head>

<body>
  <div class="content">
    <div class="card">
      <div class="card-title">
        Traffic
      </div>
      <div class="card-content">
        <div class="duration-container" style="display:none"><span class="duration"></span> to work</div>
        <div id="map-canvas"></div>
      </div>
    </div>
  </div>
  <style>
    #map-canvas {
      width: 250px;
      height: 150px;
    }
  </style>
  <script>
    console.log('script');
    function initialize(){
      console.log('initialize');
      var directionsDisplay = new google.maps.DirectionsRenderer();

      var directionsService = new google.maps.DirectionsService();

      var mapOptions = {
        center: new google.maps.LatLng(-34.397, 150.644),
        disableDefaultUI: true
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
      console.log(map);
      directionsDisplay.setMap(map);

      var geocoder = new google.maps.Geocoder();

      geocoder.geocode({address: traffic.destination}, function(results){
        var destination = results[0].geometry.location;
        var origin = new google.maps.LatLng(traffic.lat, traffic.lng);

        var request = {
          destination: destination,
          origin: origin,
          travelMode: google.maps.TravelMode.DRIVING
        };

        directionsService.route(request, function(result, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            console.log(result);
            var bounds = new google.maps.LatLngBounds();

            $('.duration').html(result.routes[0].legs[0].duration.text);
            $('.duration-container').show();

            var steps = result.routes[0].legs[0].steps;
            for(var i=0; i<steps.length; i++){
              for(var j=0; j<steps[i].lat_lngs.length; j++)
                bounds.extend(steps[i].lat_lngs[j]);
            }

            directionsDisplay.setDirections(result);
            map.fitBounds(bounds);
            map.panToBounds(bounds);
          }
        });
      });

    }

    /*$(function(){
      google.load("maps", "3", {other_params:'sensor=false', callback: function(){
          console.log('maps API loaded!');
          google.maps.event.addDomListener(window, 'load', initialize);
          initialize();
      }});
    });*/
  </script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&callback=initialize"></script>
</body>

</html>
